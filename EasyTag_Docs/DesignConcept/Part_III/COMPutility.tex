%-----------------------------------------------------------------------------------------------
%		\COMPutility{} Design
%-----------------------------------------------------------------------------------------------

\section{\COMPutility{} Design}
\label{sec:COMPutilityDesign}

In diesem Abschnitt wird das Design der Komponente \COMPutility{} beschrieben. Grundaufgabe der Komponente ist das Anbieten genereller Querschnittsfunktionalität, die unabhängig von der Fachlichkeit ist, und so potentiell in mehreren Projekten Verwendung finden kann. Hier werden allerdings nur diejenigen Aspekte beschrieben, die für \LibName{} relevant sind.


%-----------------------------------------------------------------------------------------------
%		Configuration API
%-----------------------------------------------------------------------------------------------

\subsection{Configuration API}
\label{sec:ConfigurationAPI}

Die Configuration API bietet allgemeine Funktionen für Laufzeit-Konfiguration von Software-Komponenten an. Wir entwickeln hier das Design der API.

%%%% DD --> %%%%
\DD{dd:211}
{% Titel
Ein Konfigurationsparameter wird durch eine generische Klasse \ConfigProp{} repräsentiert 
}
{% Kurzbeschreibung
Die Klasse \ConfigProp{} repräsentiert einen konkreten Konfigurationsparameter, nicht jedoch dessen Wert an sich. Der Typparameter T gibt die Klasse des Wertes der Property an, dabei gilt: \texttt{T extends Comparable}. Instanzen der Klasse \ConfigProp{} werden als Konstanten in konfigurierbaren Klassen definiert.
Die Klasse hat folgende Eigenschaften und Funktionen:
\begin{itemize}
\item \texttt{getName()}: Der Name des Konfigurationsparameters
\item \texttt{getDefaultValue()}: Der Default-Wert des Konfigurationsparameters
\item \texttt{getMaximumValue()}: Den Maximal-Wert des Konfigurationsparameters oder null, falls er keinen hat
\item \texttt{getMinimumValue()}: Den Minimal-Wert des Konfigurationsparameters oder null, falls er keinen hat
\item \texttt{getPossibleValues()}: Eine Auflistung der möglichen Werte, oder null falls er keine Auflistung fester Werte hat
\item \texttt{stringToValue()}: Konvertiert eine String-Repräsentation eines Konfigurationsparameterwertes in den eigentlichen Datentyp des Wertes
\item \texttt{valueToString()}: Konvertiert den Wert eines Konfigurationsparameterwertes in eine Stringrepräsentation
\end{itemize}
}
{% Begründung
Eine solche Repräsentation garantiert Typ-Sicherheit und eine bequeme Verwendung der API. Das Einschränken auf \texttt{Comparable} ist keine wirkliche Einschränkung, da so gut wie alle Wert-Klassen aus Java-SE, u.a. die numerischen Typen, Strings, Boolean, Character, Charset, Date, Calendar, diverse Buffer-Implementierungen usw. \texttt{Comparable} implementieren.
}
{% Nachteile
Keine bekannten Nachteile
}
%%%% <-- DD %%%%

Jede konfigurierbare Klasse soll möglichst eine einheitliche Schnittstelle bereitstellen, um Konfigurationsparameter zu setzen und abzufragen:

%%%% DD --> %%%%
\DD{dd:212}
{% Titel
Schnittstelle für das Handhaben von Konfigurationsparametern
}
{% Kurzbeschreibung
Jede konfigurierbare Klasse muss die Schnittstelle \IConfigurable{} implementieren, mit folgenden Methoden:
\begin{itemize}
\item \texttt{setConfigParam()}: Setzt den Wert eines Konfigurationsparameters
\item \texttt{getConfigParam()}: Liefert den aktuellen Wert eines Konfigurationsparameters
\item \texttt{getAllConfigParams()}: Liefert alle Konfigurationsparameter mit ihren aktuellen Werten
\item \texttt{getSupportedConfigParams()}: Liefert ein Set aller von dieser Klasse unterstützten Konfigurationsparameter
\item \texttt{getAllConfigParamsAsProperties()}: Liefert alle Konfigurationsparameter als eine \texttt{Properties}-Instanz.
\item \texttt{configureFromProperties()}: Setzt die Werte aller Konfigurationsparameter basierend auf einer \texttt{Properties}-Instanz
\item \texttt{resetConfigToDefault()}: Setzt die Werte aller Konfigurationsparameter auf ihre Default-Werte zurück
\end{itemize}

Dabei müssen alle unterstützten Konfigurationsparameter der Klasse unterschiedliche Namen haben.
}
{% Begründung
Damit wird eine einheitliche Schnittstelle für jede konfigurierbare Klasse ermöglicht. Die unterschiedlichen Namen sind zur eindeutigen Identifikation notwendig.
}
{% Nachteile
Keine bekannten Nachteile
}
%%%% <-- DD %%%%

Damit nun nicht jede Klasse selbst die Handhabung und Verifikation der Konfiguration implementieren muss, definieren wir:
%%%% DD --> %%%%
\DD{dd:213}
{% Titel
\ConfigurationHandler{} implementiert \IConfigurable{} und kann von jeder konfigurierbaren Klasse verwendet werden
}
{% Kurzbeschreibung
Die nicht-abstrakte Klasse \ConfigurationHandler{} implementiert \IConfigurable{} und übernimmt die gesamte Aufgabe der Konfiguration. Sie kann von konfigurierbaren Klassen entweder als Basisklasse oder aber als aggregierte Instanz verwendet werden, an die alle Aufrufe weitergeleitet werden.
}
{% Begründung
Keine Klasse muss die Konfigurationsverwaltung selbst implementieren
}
{% Nachteile
Keine bekannten Nachteile
}
%%%% <-- DD %%%%

Der Umgang mit fehlerhaften Konfiguration ist Teil der folgenden Designentscheidung:
%%%% DD --> %%%%
\DD{dd:214}
{% Titel
Fehlerhafte Konfigurationsparameterwerte führen zu einem Laufzeitfehler
}
{% Kurzbeschreibung
Wird ein fehlerhafter Wert für einen Konfigurationsparameter übergeben, reagiert die API mit einem Laufzeitfehler, einer \texttt{InvalidConfigParamException}. Hierfür wird eine öffentliche Methode \texttt{checkValue()} in \ConfigProp{} bereitgestellt.
}
{% Begründung
Die Wertebereiche der Parameter sind wohldefiniert und beschrieben, es handelt sich um einen Programmierfehler, wenn ein falscher Wert übergeben wird.
}
{% Nachteile
Keine bekannten Nachteile
}
%%%% <-- DD %%%%

Änderungen von Konfigurationsparametern müssen u.U. sofort wirksam werden, daher definieren wir:

%%%% DD --> %%%%
\DD{dd:215}
{% Titel
Observer-Mechanismus für Konfigurationsänderungen
}
{% Kurzbeschreibung
Es wird ein Observer-Mechanismus über \IConfigurationChangeListener{} bereitgestellt, sodass Klassen über dynamische Konfigurationsänderungen informiert werden. Dieses Interface hat lediglich eine Methode \texttt{configurationParameterValueChanged()}.

\IConfigurable{} erhält damit zwei weitere Methoden: \texttt{registerConfigurationChangeListener()} und \texttt{unregisterConfigurationChangeListener()}.
}
{% Begründung
Die konfigurierbaren Klassen müssen nicht immer diejenigen Klassen sein, welche mit den Konfigurationsänderungen umgehen müssen und die Konfigurationsparameter direkt verwenden. Stattdessen kann es sich um ein kompliziertes Klassengeflecht handeln, das zur Laufzeit keine direkte Beziehung hat. Daher ist ein entkoppelnder Listener-Mechanismus nötig.
}
{% Nachteile
Keine bekannten Nachteile
}
%%%% <-- DD %%%%



%###############################################################################################
%###############################################################################################
%
%		File end
%
%###############################################################################################
%###############################################################################################